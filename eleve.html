<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OrthÃ©sia â€” Espace classe</title>
  <link rel="stylesheet" href="assets/style.css?v=2"/>

  <style>
    .wrap{max-width:1120px;margin:0 auto;padding:24px 18px 64px;}
    .titleRow{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap;margin:10px 0 16px;}
    .kicker{color:rgba(234,241,255,.75);font-size:13px;margin-top:6px;line-height:1.35}
    .gridPics{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-top:14px;}
    .pic{border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);}
    .pic img{width:100%;height:100%;display:block;object-fit:cover;aspect-ratio:1/1;}
    @media (max-width: 980px){ .gridPics{grid-template-columns:repeat(4,1fr);} }
    @media (max-width: 620px){ .gridPics{grid-template-columns:repeat(3,1fr);} }
    @media (max-width: 420px){ .gridPics{grid-template-columns:repeat(2,1fr);} }

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 12px}
    .tab{padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06);font-weight:800;font-size:13px;cursor:pointer}
    .tab.active{border-color:rgba(122,167,255,.55);background:linear-gradient(135deg, rgba(122,167,255,.25), rgba(155,255,222,.14));}
    .panel{border:1px solid rgba(255,255,255,.14);border-radius:20px;background:rgba(255,255,255,.06);padding:16px;box-shadow:0 18px 46px rgba(0,0,0,.25);}
    .muted{color:rgba(234,241,255,.75)}
    .small{font-size:12px}
  </style>
</head>

<body>
  <nav id="sidebar" class="sidebar" aria-label="Menu">
    <div class="sidebar-header"><strong>OrthÃ©sia</strong></div>
    <a class="side-link" href="./">ğŸ  Retour portail</a>
    <a class="side-link" href="eleve.html?c=5e-proust">ğŸ“˜ 5e Proust</a>
    <a class="side-link" href="eleve.html?c=5e-sarraute">ğŸ“— 5e Sarraute</a>
    <a class="side-link" href="eleve.html?c=4e">ğŸ“™ 4e</a>
  </nav>

  <button class="hamburger" id="hamburgerBtn" type="button" aria-label="Ouvrir le menu">
    <span></span><span></span><span></span>
  </button>
  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <div class="wrap">
    <div class="topbar" style="margin-bottom:10px">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 class="h1" id="classTitle" style="margin:0">Espace classe</h1>
          <div class="sub" id="classSub">Consultation (lecture seule).</div>
        </div>
      </div>
      <a class="pill" href="./">ğŸ  Accueil</a>
    </div>

    <div class="titleRow">
      <div class="kicker">ğŸ’¡ Portraits chargÃ©s automatiquement depuis <code>classes/&lt;slug&gt;/</code>.</div>
      <div class="pill" id="stamp">ğŸ“… Mise Ã  jour : â€”</div>
    </div>

    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="portraits" type="button">ğŸ§‘â€ğŸ“ Portraits</button>
      <button class="tab" data-tab="carte" type="button">ğŸ—ºï¸ Carte</button>
      <button class="tab" data-tab="quetes" type="button">ğŸ“œ QuÃªtes</button>
      <button class="tab" data-tab="progres" type="button">ğŸ† ProgrÃ¨s</button>
    </div>

    <div class="panel" id="content"></div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("hamburgerBtn");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    if(!btn || !sidebar || !overlay) return;

    btn.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      overlay.classList.toggle("show");
    });
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    });
  });
  </script>

  <script>
  const OWNER = "davidlotram";
  const REPO  = "orthesia";

  const contentEl = document.getElementById("content");
  const titleEl   = document.getElementById("classTitle");
  const subEl     = document.getElementById("classSub");
  const stampEl   = document.getElementById("stamp");

  function getSlug(){
    const p = new URLSearchParams(location.search);
    return (p.get("c") || "").trim();
  }
  function niceName(slug){
    if(slug === "5e-proust") return "5e Proust";
    if(slug === "5e-sarraute") return "5e Sarraute";
    if(slug === "4e") return "4e";
    return slug || "Classe";
  }
  function setStamp(){
    const d = new Date();
    const pad = n => String(n).padStart(2,"0");
    stampEl.textContent = `ğŸ“… Mise Ã  jour : ${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  async function fetchImages(slug){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/classes/${encodeURIComponent(slug)}`;
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error("Impossible de lire le dossier (API GitHub).");
    const items = await res.json();
    const imgs = items
      .filter(it => it && it.type === "file")
      .filter(it => /\.(png|jpg|jpeg|webp)$/i.test(it.name))
      .map(it => `classes/${slug}/${it.name}`);
    imgs.sort((a,b)=>a.localeCompare(b, "fr", {numeric:true, sensitivity:"base"}));
    return imgs;
  }

  function renderPlaceholder(tab){
    const map = {
      carte:  `ğŸ—ºï¸ <b>Carte</b><br><span class="muted">Ã€ brancher plus tard avec tes pages RPG â€œviewâ€. (Ici : consultation.)</span>`,
      quetes: `ğŸ“œ <b>QuÃªtes</b><br><span class="muted">MÃªme chose : on pourra intÃ©grer les quÃªtes RPG ici.</span>`,
      progres:`ğŸ† <b>ProgrÃ¨s</b><br><span class="muted">Boss + succÃ¨s + pÃ©riodes seront affichÃ©s ici quand tu publieras la page â€œviewâ€.</span>`,
    };
    contentEl.innerHTML = `<div class="muted">${map[tab] || ""}</div>`;
  }

  async function renderPortraits(slug){
    contentEl.innerHTML = `<div class="muted">Chargement des portraitsâ€¦</div>`;
    try{
      const imgs = await fetchImages(slug);
      if(!imgs.length){
        contentEl.innerHTML = `<div class="muted">Aucune image trouvÃ©e dans <code>classes/${slug}/</code>.</div>`;
        return;
      }
      contentEl.innerHTML = `
        <div class="muted small">Dossier : <code>classes/${slug}/</code> â€” ${imgs.length} image(s)</div>
        <div class="gridPics">
          ${imgs.map(src => `<div class="pic"><img loading="lazy" src="${src}" alt=""></div>`).join("")}
        </div>
      `;
    }catch(e){
      contentEl.innerHTML = `
        <div class="warn">
          ${String(e.message || e)}
          <div class="muted small" style="margin-top:8px">
            Si lâ€™API GitHub est temporairement limitÃ©e, rÃ©essaie plus tard.
          </div>
        </div>
      `;
    }
  }

  function setActiveTab(tab){
    document.querySelectorAll(".tab").forEach(b => b.classList.toggle("active", b.dataset.tab===tab));
    const slug = getSlug();
    if(tab === "portraits") renderPortraits(slug);
    else renderPlaceholder(tab);
  }

  (function init(){
    const slug = getSlug();
    if(!slug){
      titleEl.textContent = "Code de classe manquant";
      subEl.textContent = "Retourne Ã  lâ€™accueil et entre le code.";
      contentEl.innerHTML = `<div class="warn">Il manque le paramÃ¨tre <code>?c=...</code>. Retourne au <a href="./">portail</a>.</div>`;
      return;
    }
    titleEl.textContent = `Espace â€” ${niceName(slug)}`;
    subEl.textContent = "Consultation (lecture seule).";
    setStamp();

    document.getElementById("tabs").addEventListener("click", (e)=>{
      const btn = e.target.closest(".tab");
      if(!btn) return;
      setActiveTab(btn.dataset.tab);
    });

    setActiveTab("portraits");
  })();
  </script>
</body>
</html>
