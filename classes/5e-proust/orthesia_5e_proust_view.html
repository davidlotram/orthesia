<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Orth√©sia ‚Äî Consultation</title>
<style>
:root{--bg:#0b1020;--text:#f5f5f5;--muted:#c9c9c9;--line:rgba(255,255,255,.12);--accent:rgba(139,211,255,.16);}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(1200px 700px at 20% 10%, #18214a 0%, var(--bg) 55%),
             radial-gradient(900px 600px at 90% 30%, #1a3b3b 0%, rgba(0,0,0,0) 60%);
  color:var(--text)}
body.wm::before{content:attr(data-wm);position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  font-size:clamp(18px,3.2vw,40px);letter-spacing:.6px;color:rgba(255,255,255,.07);transform:rotate(-18deg);
  pointer-events:none;z-index:0;white-space:nowrap;user-select:none}
header{padding:18px;border-bottom:1px solid var(--line);background:rgba(18,26,51,.55);backdrop-filter:blur(8px);
  position:sticky;top:0;z-index:10;display:flex;gap:10px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
.title h1{margin:0;font-size:16px}
.title small{color:var(--muted);display:block;margin-top:2px}
.updated{margin-top:6px;color:var(--muted);font-size:12px}
.pillrow{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
.pill{padding:6px 10px;border:1px solid var(--line);background:rgba(255,255,255,.06);border-radius:999px;font-size:12px}
main{max-width:1100px;margin:0 auto;padding:18px;position:relative;z-index:1}
.grid{display:grid;grid-template-columns:280px 1fr;gap:14px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{border:1px solid var(--line);background:rgba(18,26,51,.55);border-radius:16px;padding:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
.muted{color:var(--muted);font-size:13px;line-height:1.35}
.mini{color:var(--muted);font-size:12px;line-height:1.35}
.hr{height:1px;background:var(--line);margin:12px 0}
.nav button{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);
  color:var(--text);cursor:pointer;text-align:left;margin-bottom:8px}
.nav button.active{background:var(--accent);border-color:rgba(139,211,255,.35)}
.map{position:relative;border:1px solid var(--line);border-radius:16px;overflow:hidden;min-height:440px;background:rgba(0,0,0,.20)}
.mapCam{position:absolute;inset:0}
.node{position:absolute;width:min(160px,42vw);padding:8px 9px;border-radius:14px;border:1px solid var(--line);background:rgba(0,0,0,.22)}
.node h3{margin:0 0 3px;font-size:12px}
.node small{color:var(--muted);font-size:11px;line-height:1.15}
.badge{display:inline-block;margin-top:8px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);background:rgba(255,255,255,.06)}
.node.selected{background:rgba(139,211,255,.18);border-color:rgba(139,211,255,.45)}
.list{display:grid;grid-template-columns:repeat(2,minmax(240px,1fr));gap:10px}
@media(max-width:900px){.list{grid-template-columns:1fr}}
.char{border:1px solid var(--line);border-radius:14px;padding:12px;background:rgba(0,0,0,.18)}
.charTop{display:flex;justify-content:space-between;gap:10px;align-items:center}
.tag{font-size:12px;color:var(--muted)}
.bar{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;border:1px solid var(--line);margin-top:10px}
.bar>div{height:100%;width:0%}
.barXp>div{background:linear-gradient(90deg, rgba(139,211,255,.9), rgba(157,255,176,.9))}
.stats{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px}
.avatarBox{width:44px;height:44px;border-radius:12px;overflow:hidden;border:1px solid var(--line);background:rgba(255,255,255,.06);
  display:flex;align-items:center;justify-content:center;flex:0 0 auto}
.avatarBox img{width:100%;height:100%;object-fit:cover}
.avatarFallback{font-size:22px}
footer{padding:14px 18px;color:var(--muted);font-size:12px;text-align:center;position:relative;z-index:1}
.hpWrap{border:1px solid rgba(255,255,255,.14);border-radius:14px;overflow:hidden;background:rgba(255,255,255,.06);height:14px}
.hpFill{height:100%;width:100%;transition:width .35s ease;background:linear-gradient(90deg, rgba(157,255,176,.95), rgba(139,211,255,.75))}
.hpLabel{font-size:12px;color:rgba(255,255,255,.78);margin:6px 0 10px}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table td,.table th{padding:8px 10px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18)}
.table th{color:rgba(255,255,255,.82);font-size:12px;text-align:left}
.pillOk{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.16);background:rgba(157,255,176,.15);font-size:12px}
.pillTodo{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.16);background:rgba(255,231,136,.12);font-size:12px}
</style>
</head>
<body>
<header>
  <div class="title">
    <h1 id="pageTitle"></h1>
    <small id="pageSubtitle"></small>
    <div class="updated" id="updatedAt" style="display:none"></div>
  </div>
  <div class="pillrow">
    <span class="pill" id="pillChapter">Zone : ‚Äî</span>
    <span class="pill" id="pillTeam">√âquipe : ‚Äî</span>
    <span class="pill" id="pillXP">XP total : ‚Äî</span>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card nav">
      <h2 style="margin:0 0 8px;font-size:14px">Menu</h2>
      <button class="active" data-view="map">üó∫Ô∏è Carte</button>
      <button data-view="roster">üë• √âquipe</button>
      <button data-view="quests">üìú Qu√™tes</button>
      <button data-view="progress">üèÜ Progr√®s</button>
      <div class="hr"></div>
      <p class="muted"><b>Lecture seule :</b> tu peux consulter les avanc√©es, rien modifier.</p>
    </section>

    <section class="card" id="view"></section>
  </div>
</main>

<footer id="footerText"></footer>

<script type="application/json" id="META">{"title":"Le Royaume d‚ÄôOrth√©sia ‚Äî 5e Proust","subtitle":"Version consultation (lecture seule) ‚Äî aucune modification possible ici.","footer":"Page de consultation. Les mises √† jour sont publi√©es par le professeur.","watermark":"Orth√©sia ‚Äî 5e Proust ‚Äî Consultation","watermarkOn":true,"stampOn":true,"updatedAt":"21/12/2025 √† 14:13"}</script>
<script type="application/json" id="STATE">{"zoneId":"cite","party":[{"id":"s0","name":"Wyatt","cls":"√âclaireur","trait":"√©nergie","role":null,"quest":"Qu√™te : participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"wyatt.png","icon":"‚ú®"},{"id":"s1","name":"Lyna","cls":"Savant","trait":"application","role":null,"quest":"Qu√™te : t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire, et participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"lyna.png","icon":"üìò"},{"id":"s2","name":"J√©r√©mie","cls":"Apprenti","trait":"pers√©v√©rance","role":null,"quest":"Qu√™te : t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire, et oser davantage et te faire confiance.","xp":0,"hp":30,"hpMax":30,"portrait":"jeremie.png","icon":"üå±"},{"id":"s3","name":"Alicia","cls":"Savant","trait":"application","role":null,"quest":"Qu√™te : t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire.","xp":0,"hp":30,"hpMax":30,"portrait":"alicia.png","icon":"üìò"},{"id":"s4","name":"Jules","cls":"Apprenti","trait":"volont√©","role":null,"quest":"Qu√™te : rester concentr√©(e) et √©viter la dispersion.","xp":0,"hp":30,"hpMax":30,"portrait":"jules.png","icon":"üå±"},{"id":"s5","name":"Th√©o","cls":"Gardien","trait":"stabilit√©","role":null,"quest":"Qu√™te : avancer avec constance et r√©gularit√©.","xp":0,"hp":30,"hpMax":30,"portrait":"th√©o.png","icon":"üõ°Ô∏è"},{"id":"s6","name":"Pavel","cls":"√âclaireur","trait":"curiosit√©","role":null,"quest":"Qu√™te : participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"pavel.png","icon":"‚ú®"},{"id":"s7","name":"Ewenn","cls":"Apprenti","trait":"progression","role":null,"quest":"Qu√™te : rester concentr√©(e) et √©viter la dispersion, et t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire.","xp":0,"hp":30,"hpMax":30,"portrait":"ewenn.png","icon":"üå±"},{"id":"s8","name":"Emma","cls":"Messager","trait":"clart√©","role":null,"quest":"Qu√™te : oser davantage et te faire confiance, et participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"emma.png","icon":"üó£Ô∏è"},{"id":"s9","name":"Marina","cls":"Savant","trait":"rigueur","role":null,"quest":"Qu√™te : t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire.","xp":0,"hp":30,"hpMax":30,"portrait":"marina.png","icon":"üìò"},{"id":"s10","name":"Sam","cls":"Gardien","trait":"r√©gularit√©","role":null,"quest":"Qu√™te : oser davantage et te faire confiance.","xp":0,"hp":30,"hpMax":30,"portrait":"sam.png","icon":"üõ°Ô∏è"},{"id":"s11","name":"Yanis","cls":"√âclaireur","trait":"dynamisme","role":null,"quest":"Qu√™te : rester concentr√©(e) et √©viter la dispersion.","xp":0,"hp":30,"hpMax":30,"portrait":"yanis.png","icon":"‚ú®"},{"id":"s12","name":"Typhanie","cls":"Messager","trait":"pr√©sence","role":null,"quest":"Qu√™te : rester concentr√©(e) et √©viter la dispersion, et participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"typhanie.png","icon":"üó£Ô∏è"},{"id":"s13","name":"Lola","cls":"Savant","trait":"potentiel","role":null,"quest":"Qu√™te : rester concentr√©(e) et √©viter la dispersion, et t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire.","xp":0,"hp":30,"hpMax":30,"portrait":"lola.png","icon":"üìò"},{"id":"s14","name":"Zo√©","cls":"Gardien","trait":"s√©rieux","role":null,"quest":"Qu√™te : avancer avec constance et r√©gularit√©.","xp":0,"hp":30,"hpMax":30,"portrait":"zo√©.png","icon":"üõ°Ô∏è"},{"id":"s15","name":"Shannon","cls":"Apprenti","trait":"pers√©v√©rance","role":null,"quest":"Qu√™te : t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire, et oser davantage et te faire confiance.","xp":0,"hp":30,"hpMax":30,"portrait":"shannon.png","icon":"üå±"},{"id":"s16","name":"Coline","cls":"Messager","trait":"int√©gration","role":null,"quest":"Qu√™te : oser davantage et te faire confiance, et participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"coline.png","icon":"üó£Ô∏è"},{"id":"s17","name":"Yuri","cls":"Apprenti","trait":"√©nergie","role":null,"quest":"Qu√™te : rester concentr√©(e) et √©viter la dispersion, et t‚Äôappuyer sur une m√©thode simple : lire, planifier, relire.","xp":0,"hp":30,"hpMax":30,"portrait":"yuri.png","icon":"üå±"},{"id":"s18","name":"Simon","cls":"Apprenti","trait":"capacit√©","role":null,"quest":"Qu√™te : oser davantage et te faire confiance.","xp":0,"hp":30,"hpMax":30,"portrait":"simon.png","icon":"üå±"},{"id":"s19","name":"Ma√´lye","cls":"Messager","trait":"s√©rieux","role":null,"quest":"Qu√™te : oser davantage et te faire confiance, et participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"maelye.png","icon":"üó£Ô∏è"},{"id":"s20","name":"Louane","cls":"Messager","trait":"adaptation","role":null,"quest":"Qu√™te : oser davantage et te faire confiance, et participer, m√™me bri√®vement, pour faire grandir tes id√©es.","xp":0,"hp":30,"hpMax":30,"portrait":"louane.png","icon":"üó£Ô∏è"}],"louaneIntroDone":true,"quests":[{"id":"q1","title":"Le Parchemin de la M√©thode","done":false,"reward":6,"desc":"Relire, corriger, am√©liorer un √©crit."},{"id":"q2","title":"La Clef de la Confiance","done":false,"reward":6,"desc":"Oser une participation (m√™me courte)."},{"id":"q3","title":"Le Bouclier de l‚ÄôAttention","done":false,"reward":6,"desc":"Tenir une phase de travail sans distraction."}],"boss":{"id":"boss_t1","name":"Le Grand Brouillard du Trimestre","hp":120,"hpMax":120,"weakness":"methode","status":"active","log":["Le brouillard s‚Äô√©paissit‚Ä¶ mais l‚Äô√©quipe avance.","Une phrase bien construite dissipe une ombre."]},"achievements":[{"id":"focus_10","title":"10 minutes de focus","desc":"La classe a tenu 10 minutes sans interruption.","unlocked":false,"date":""},{"id":"copies_30","title":"30 relectures","desc":"30 copies relues s√©rieusement.","unlocked":false,"date":""},{"id":"oral_10","title":"10 prises de parole","desc":"10 √©l√®ves ont particip√© √† l‚Äôoral.","unlocked":false,"date":""}],"periods":[{"id":"jan","label":"Janvier","goal":"Reprendre confiance","boss":"Le Doute persistant","teamXp":0,"questsDone":0,"notes":""},{"id":"feb","label":"F√©vrier","goal":"Se concentrer","boss":"La Dispersion","teamXp":0,"questsDone":0,"notes":""},{"id":"mar","label":"Mars","goal":"Oser participer","boss":"La Peur de se tromper","teamXp":0,"questsDone":0,"notes":""},{"id":"apr","label":"Avril","goal":"Tenir l‚Äôeffort","boss":"La Fatigue","teamXp":0,"questsDone":0,"notes":""},{"id":"may","label":"Mai","goal":"√ätre rigoureux","boss":"La Pr√©cipitation","teamXp":0,"questsDone":0,"notes":""},{"id":"jun","label":"Juin","goal":"Boss final","boss":"L‚ÄôOmbre d‚ÄôOrth√©sia","teamXp":0,"questsDone":0,"notes":""}],"meta":{"updatedAt":"21/12/2025 14:12","finalShown":false},"battle":{"enemy":{"id":"doute","name":"Le Doute","hp":35,"atk":6,"msg":"Il murmure : ‚ÄúTu n‚Äôy arriveras pas‚Ä¶‚Äù"},"enemyHp":35,"turnIndex":0,"shield":0,"log":["\u003cb>Un obstacle appara√Æt :\u003c/b> Le Doute.","Votre classe respire‚Ä¶ et se pr√©pare."]},"teamXp":0}</script>
<script type="application/json" id="ZONES">[{"id":"plaine","name":"Plaine de la Compr√©hension","desc":"Lire, comprendre, rep√©rer l'essentiel.","x":8,"y":15},{"id":"foret","name":"For√™t de l‚Äô√âcriture","desc":"√âcrire, structurer, am√©liorer.","x":40,"y":44},{"id":"cite","name":"Cit√© de l‚ÄôOral","desc":"Prendre la parole avec confiance.","x":74,"y":14},{"id":"mont","name":"Montagne de la M√©thode","desc":"S'organiser, relire, progresser.","x":18,"y":64},{"id":"sanct","name":"Sanctuaire de la Confiance","desc":"Oser, pers√©v√©rer, grandir.","x":74,"y":64}]</script>

<script>
"use strict";
function getJson(id){ try{ return JSON.parse(document.getElementById(id).textContent || "{}"); } catch(e){ return {}; } }
const meta = getJson("META");
const stateRaw = getJson("STATE");
const zones = getJson("ZONES");

if(meta.watermarkOn){ document.body.classList.add("wm"); document.body.dataset.wm = meta.watermark || ""; }
document.getElementById("pageTitle").textContent = meta.title || "";
document.getElementById("pageSubtitle").textContent = meta.subtitle || "";
const upd = document.getElementById("updatedAt");
if(meta.stampOn){ upd.style.display = "block"; upd.textContent = "Mise √† jour du " + (meta.updatedAt || ""); }
document.getElementById("footerText").textContent = meta.footer || "";

const state = (function(s){
  const safe = (s && typeof s==="object") ? s : {};
  safe.zoneId = (typeof safe.zoneId==="string") ? safe.zoneId : (zones[0] ? zones[0].id : "");
  safe.party = Array.isArray(safe.party) ? safe.party : [];
  safe.quests = Array.isArray(safe.quests) ? safe.quests : [];
  safe.boss = (safe.boss && typeof safe.boss==="object") ? safe.boss : null;
  safe.achievements = Array.isArray(safe.achievements) ? safe.achievements : [];
  safe.periods = Array.isArray(safe.periods) ? safe.periods : [];
  return safe;
})(stateRaw);

function levelFromXP(xp){ xp=Number(xp)||0; if(xp<10)return 1; if(xp<22)return 2; if(xp<38)return 3; if(xp<58)return 4; return 5; }
function xpToNext(level){ const t=[0,10,22,38,58,999]; return t[level]||999; }

function updatePills(){
  const zone = zones.find(z=>z.id===state.zoneId);
  const teamCount = state.party.length;
  const totalXP = state.party.reduce((a,p)=>a+(Number(p.xp)||0),0);
  document.getElementById("pillChapter").textContent = "Zone : " + (zone?zone.name:"‚Äî");
  document.getElementById("pillTeam").textContent = "√âquipe : " + teamCount + " h√©ros";
  document.getElementById("pillXP").textContent = "XP total : " + totalXP;
}

const viewEl = document.getElementById("view");
const navBtns = Array.from(document.querySelectorAll(".nav button[data-view]"));
function setView(v){
  navBtns.forEach(b=>b.classList.toggle("active", b.dataset.view===v));
  render(v);
}
navBtns.forEach(b=>b.addEventListener("click", (e)=>{ e.preventDefault(); setView(b.dataset.view); }));

function render(v){
  updatePills();
  if(v==="map") return renderMap();
  if(v==="roster") return renderRoster();
  if(v==="quests") return renderQuests();
  if(v==="progress") return renderProgress();
}

function renderMap(){
  viewEl.textContent = "";
  const zone = zones.find(z=>z.id===state.zoneId);

  const h=document.createElement("h2"); h.style.margin="0 0 8px"; h.style.fontSize="14px"; h.textContent="üó∫Ô∏è Carte (consultation)"; viewEl.appendChild(h);
  const p=document.createElement("p"); p.className="muted"; p.textContent="Zone actuelle mise √† jour par le professeur."; viewEl.appendChild(p);

  const map=document.createElement("div"); map.className="map";
  const cam=document.createElement("div"); cam.className="mapCam"; map.appendChild(cam);
  viewEl.appendChild(map);

  zones.forEach(z=>{
    const n=document.createElement("div");
    n.className="node" + (z.id===state.zoneId ? " selected" : "");
    n.style.left = z.x + "%";
    n.style.top  = z.y + "%";
    const t=document.createElement("h3"); t.textContent=z.name; n.appendChild(t);
    const s=document.createElement("small"); s.textContent=z.desc; n.appendChild(s);
    const spacer=document.createElement("div"); spacer.style.height="8px"; n.appendChild(spacer);
    const b=document.createElement("span"); b.className="badge"; b.textContent = (z.id===state.zoneId ? "Vous √™tes ici" : "Zone"); n.appendChild(b);
    cam.appendChild(n);
  });

  const hr=document.createElement("div"); hr.className="hr"; viewEl.appendChild(hr);
  const mini=document.createElement("p"); mini.className="mini";
  mini.textContent = "Zone actuelle : " + (zone?zone.name:"‚Äî") + " ‚Äî " + (zone?zone.desc:"");
  viewEl.appendChild(mini);
}

function renderRoster(){
  viewEl.textContent="";
  const h=document.createElement("h2"); h.style.margin="0 0 8px"; h.style.fontSize="14px"; h.textContent="üë• √âquipe (consultation)"; viewEl.appendChild(h);
  const p=document.createElement("p"); p.className="muted"; p.textContent="Progression visible. Aucun bouton d‚Äôaction ici."; viewEl.appendChild(p);

  const list=document.createElement("div"); list.className="list"; viewEl.appendChild(list);
  if(state.party.length===0){
    const d=document.createElement("div"); d.className="char";
    const hh=document.createElement("h3"); hh.style.margin="0"; hh.textContent="Aucune donn√©e"; d.appendChild(hh);
    const tg=document.createElement("div"); tg.className="tag"; tg.textContent="Le professeur n‚Äôa pas encore publi√©."; d.appendChild(tg);
    list.appendChild(d); return;
  }

  state.party.forEach(pers=>{
    const xp = Number(pers.xp)||0;
    const lvl = levelFromXP(xp);
    const next = xpToNext(lvl+1);
    const prev = xpToNext(lvl);
    const span = Math.max(1, next-prev);
    const prog = Math.min(100, Math.round(((xp-prev)/span)*100));

    const card=document.createElement("div"); card.className="char";
    const top=document.createElement("div"); top.className="charTop"; card.appendChild(top);

    const left=document.createElement("div");
    left.style.display="flex"; left.style.gap="10px"; left.style.alignItems="center";
    top.appendChild(left);

    const av=document.createElement("div"); av.className="avatarBox"; left.appendChild(av);
    const icon = (pers.icon || "‚ú®");
    if(pers.portrait){
      const img=new Image();
      img.src = pers.portrait;
      img.alt = pers.name || "";
      img.onerror = ()=>{ av.textContent = icon; av.classList.add("avatarFallback"); };
      av.appendChild(img);
    }else{
      av.textContent = icon;
      av.classList.add("avatarFallback");
    }

    const txt=document.createElement("div"); left.appendChild(txt);
    const nm=document.createElement("h3"); nm.style.margin="0"; nm.textContent=(pers.name||"‚Äî"); txt.appendChild(nm);
    const tg=document.createElement("div"); tg.className="tag"; tg.textContent=(pers.cls||"‚Äî")+" ‚Ä¢ Qualit√© : "+(pers.trait||"‚Äî"); txt.appendChild(tg);

    const right=document.createElement("div"); right.className="tag"; right.textContent="Niv. "+lvl; top.appendChild(right);

    const bar=document.createElement("div"); bar.className="bar barXp";
    const fill=document.createElement("div"); fill.style.width = prog + "%";
    bar.appendChild(fill); card.appendChild(bar);

    const stats=document.createElement("div"); stats.className="stats";
    stats.innerHTML = "<span>XP : <b>"+xp+"</b></span><span>Prochain niv. : <b>"+(next===999 ? "‚Äî" : next)+"</b></span>";
    card.appendChild(stats);

    if(pers.quest){
      const q=document.createElement("div"); q.className="mini";
      const b=document.createElement("b"); b.textContent = pers.quest;
      q.appendChild(b); card.appendChild(q);
    }
    list.appendChild(card);
  });
}

function renderQuests(){
  viewEl.textContent="";
  const h=document.createElement("h2"); h.style.margin="0 0 8px"; h.style.fontSize="14px"; h.textContent="üìú Qu√™tes (consultation)"; viewEl.appendChild(h);
  const p=document.createElement("p"); p.className="muted"; p.textContent="√âtat : √† faire / accomplie."; viewEl.appendChild(p);

  if(state.quests.length===0){
    const d=document.createElement("div"); d.className="char";
    const hh=document.createElement("h3"); hh.style.margin="0"; hh.textContent="Aucune qu√™te"; d.appendChild(hh);
    const tg=document.createElement("div"); tg.className="tag"; tg.textContent="Le professeur n‚Äôa pas encore publi√©."; d.appendChild(tg);
    viewEl.appendChild(d); return;
  }

  state.quests.forEach(q=>{
    const card=document.createElement("div"); card.className="char";
    const top=document.createElement("div"); top.className="charTop"; card.appendChild(top);

    const left=document.createElement("div"); top.appendChild(left);
    const t=document.createElement("h3"); t.style.margin="0"; t.textContent=(q.title||"Qu√™te"); left.appendChild(t);
    const d=document.createElement("div"); d.className="tag"; d.textContent=(q.desc||""); left.appendChild(d);

    const r=document.createElement("div"); r.className="tag";
    r.textContent = "R√©compense : " + (Number(q.reward)||0) + " XP";
    top.appendChild(r);

    const hr=document.createElement("div"); hr.className="hr"; card.appendChild(hr);
    const st=document.createElement("div"); st.className="tag"; st.textContent = (q.done ? "‚úÖ Accomplie" : "‚òê √Ä faire");
    card.appendChild(st);

    viewEl.appendChild(card);
  });
}

function renderProgress(){
  viewEl.textContent="";
  const h=document.createElement("h2"); h.style.margin="0 0 8px"; h.style.fontSize="14px"; h.textContent="üèÜ Progr√®s (consultation)"; viewEl.appendChild(h);
  const p=document.createElement("p"); p.className="muted"; p.textContent="Boss collectif, succ√®s et progression par p√©riode."; viewEl.appendChild(p);

  // Boss
  if(state.boss){
    const hp = Number(state.boss.hp);
    const hpMax = Math.max(1, Number(state.boss.hpMax || state.boss.hp));
    const pct = Math.max(0, Math.min(100, Math.round((hp / hpMax) * 100)));

    const box=document.createElement("div"); box.className="char";
    const t=document.createElement("h3"); t.style.margin="0 0 6px"; t.textContent = "üëπ " + (state.boss.name || "Boss");
    box.appendChild(t);

    const wrap=document.createElement("div"); wrap.className="hpWrap";
    const fill=document.createElement("div"); fill.className="hpFill"; fill.style.width = pct + "%";
    wrap.appendChild(fill); box.appendChild(wrap);

    const lab=document.createElement("div"); lab.className="hpLabel";
    lab.textContent = "PV : " + (state.boss.hp ?? "‚Äî") + " / " + (state.boss.hpMax ?? "‚Äî") + " (" + pct + "%)";
    box.appendChild(lab);

    viewEl.appendChild(box);
  } else {
    const d=document.createElement("div"); d.className="char"; d.textContent="Boss : non publi√©."; viewEl.appendChild(d);
  }

  const hr1=document.createElement("div"); hr1.className="hr"; viewEl.appendChild(hr1);

  // Succ√®s
  const ah=document.createElement("h3"); ah.style.margin="0 0 6px"; ah.textContent="üèÖ Succ√®s collectifs";
  viewEl.appendChild(ah);

  if(state.achievements.length===0){
    const d=document.createElement("div"); d.className="char"; d.textContent="Aucun succ√®s publi√©."; viewEl.appendChild(d);
  } else {
    state.achievements.forEach(a=>{
      const item=document.createElement("div"); item.className="char";
      const top=document.createElement("div"); top.className="charTop"; item.appendChild(top);

      const left=document.createElement("div"); top.appendChild(left);
      const tt=document.createElement("h3"); tt.style.margin="0"; tt.textContent = a.title || "Succ√®s"; left.appendChild(tt);
      const dd=document.createElement("div"); dd.className="tag"; dd.textContent = a.desc || ""; left.appendChild(dd);

      const badge=document.createElement("div"); badge.className="tag";
      badge.innerHTML = a.unlocked ? '<span class="pillOk">D√©bloqu√©</span>' : '<span class="pillTodo">√Ä d√©bloquer</span>';
      top.appendChild(badge);

      viewEl.appendChild(item);
    });
  }

  const hr2=document.createElement("div"); hr2.className="hr"; viewEl.appendChild(hr2);

  // P√©riodes
  const ph=document.createElement("h3"); ph.style.margin="0 0 6px"; ph.textContent="üìÖ P√©riodes";
  viewEl.appendChild(ph);

  if(state.periods.length===0){
    const d=document.createElement("div"); d.className="char"; d.textContent="Aucune p√©riode publi√©e."; viewEl.appendChild(d);
  } else {
    const table=document.createElement("table"); table.className="table";
    table.innerHTML = "<thead><tr><th>P√©riode</th><th>XP √©quipe</th><th>Qu√™tes</th><th>Note</th></tr></thead>";
    const tb=document.createElement("tbody");

    state.periods.forEach(pr=>{
      const tr=document.createElement("tr");
      const td1=document.createElement("td");
      td1.textContent = String(pr.label || pr.id || "‚Äî") + (pr.dateRange ? " (" + pr.dateRange + ")" : "");
      const td2=document.createElement("td"); td2.textContent = String(pr.teamXp ?? "‚Äî");
      const td3=document.createElement("td"); td3.textContent = String(pr.questsDone ?? "‚Äî");
      const td4=document.createElement("td"); td4.textContent = String(pr.notes ?? "");
      tr.append(td1, td2, td3, td4);
      tb.appendChild(tr);
    });

    table.appendChild(tb);
    viewEl.appendChild(table);
  }
}

setView("map");
</script>
</body>
</html>